// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-ndarray-like@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gdot@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gaxpy@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dscal@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-max@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-exp@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-expit@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-shape2strides@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-numel@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-vind2bind@esm/index.mjs";import _ from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-number@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import R from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@esm/index.mjs";import x from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import L from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";var T=i,Q=n,H=r,M=a.ndarray,N=o.ndarray,z=d,F=l,q=h,P=p,S=m,k=c,O=g,V=f,A=u,B=b,C=j,D={basic:"_basicLearningRate",constant:"_constantLearningRate",invscaling:"_inverseScalingLearningRate",pegasos:"_pegasosLearningRate"},G={hinge:"_hingeLoss",log:"_logLoss",modifiedHuber:"_modifiedHuberLoss",perceptron:"_perceptronLoss",squaredHinge:"_squaredHingeLoss"};function I(t,e){var s;return this._N=t,this._opts=e,this._scaleFactor=1,this._t=0,this._learningRateMethod=D[e.learningRate[0]],this._lossMethod=G[e.loss],s=t,e.intercept&&(s+=1),this._weights=new O(s),this._coefficients=new V("float64",new O(s),[s],[1],0,"row-major"),this}T(I.prototype,"_add",(function(t,e){var s=e/this._scaleFactor,i=this._weights;return N(t.shape[0],s,t.data,t.strides[0],t.offset,i,1,0),this._opts.intercept&&(i[this._N]+=s),this})),T(I.prototype,"_basicLearningRate",(function(){return 10/(10+this._t)})),T(I.prototype,"_constantLearningRate",(function(){return this._opts.learningRate[1]})),T(I.prototype,"_dot",(function(t,e,s){var i=M(this._N,this._weights,1,0,t,e,s);return this._opts.intercept&&(i+=this._weights[this._N]),i*=this._scaleFactor})),T(I.prototype,"_hingeLoss",(function(t,e){var s;return s=this[this._learningRateMethod](),this._regularize(s),e*this._dot(t.data,t.strides[0],t.offset)<1&&this._add(t,e*s),this})),T(I.prototype,"_inverseScalingLearningRate",(function(){var t=this._opts.learningRate;return t[1]/S(this._t,t[2])})),T(I.prototype,"_logLoss",(function(t,e){var s,i,r;return i=this[this._learningRateMethod](),this._regularize(i),r=this._dot(t.data,t.strides[0],t.offset),s=e/(1+P(e*r)),this._add(t,i*s),this})),T(I.prototype,"_modifiedHuberLoss",(function(t,e){var s,i;return s=this[this._learningRateMethod](),this._regularize(s),(i=e*this._dot(t.data,t.strides[0],t.offset))<-1?this._add(t,4*s*e):this._add(t,s*(e-i*e)),this})),T(I.prototype,"_pegasosLearningRate",(function(){return 1/(this._opts.lambda*this._t)})),T(I.prototype,"_perceptronLoss",(function(t,e){var s;return s=this[this._learningRateMethod](),this._regularize(s),e*this._dot(t.data,t.strides[0],t.offset)<=0&&this._add(t,e*s),this})),T(I.prototype,"_regularize",(function(t){var e=this._opts.lambda;return e<=0||this._scale(q(1-t*e,1e-7)),this})),T(I.prototype,"_scale",(function(t){var e;if(t<=0)throw new RangeError(H("0LQ4w",t));return(e=this._scaleFactor)<1e-11&&(F(this._N,e,this._weights,1),this._scaleFactor=1),this._scaleFactor*=t,this})),T(I.prototype,"_squaredHingeLoss",(function(t,e){var s,i;return s=this[this._learningRateMethod](),this._regularize(s),(i=e*this._dot(t.data,t.strides[0],t.offset))<1&&this._add(t,s*(e-i*e)),this})),Q(I.prototype,"coefficients",(function(){var t=this._coefficients.data,e=this._weights;return z(e.length,e,1,t,1),F(this._N,this._scaleFactor,t,1),this._coefficients})),Q(I.prototype,"nfeatures",(function(){return this._N})),T(I.prototype,"predict",(function(t,e){var s,i,r,n,a,o,d,l,h,p,m,c,g,f,u,b;for(i=t.data,n=t.shape,h=t.strides,m=t.offset,o=t.order,s=n.length-1,a=[],b=0;b<s;b++)a.push(n[b]);for(0===s?(c=1,r=new O(1),p=[0]):(c=B(a),r=new O(c),p=A(a,o)),f=new V("int8",r,a,p,0,o),g=this._N,l=h[s],b=0;b<c;b++)d=C(n,h,m,o,b*g,"throw"),u=this._dot(i,l,d),"label"===e?u=u>0?1:-1:"probability"===e&&(u=k(u)),0===s?f.iset(u):f.iset(b,u);return f})),T(I.prototype,"update",(function(t,e){return this._t+=1,this[this._lossMethod](t,e)}));var J=I,K={basic:["basic"],constant:["constant",.02],invscaling:["invscaling",.02,.5],pegasos:["pegasos"]},U=_.isPrimitive,W=v.isPrimitive,X=y.isPrimitive,Y=w.isPrimitive,Z=R,$=x,tt=L,et=E,st=r,it=["basic","constant","invscaling","pegasos"],rt=["hinge","log","modifiedHuber","perceptron","squaredHinge"];var nt=function(t,e){var s;if(!$(e))return new TypeError(st("0LQ2h",e));if(tt(e,"intercept")&&(t.intercept=e.intercept,!Y(t.intercept)))return new TypeError(st("0LQ30","intercept",t.intercept));if(tt(e,"lambda")&&(t.lambda=e.lambda,!U(t.lambda)))return new TypeError(st("0LQ4x","lambda",t.lambda));if(tt(e,"learningRate")){if(!Z(e.learningRate))return new TypeError(st("0LQ4y","learningRate",e.learningRate));if(s=e.learningRate[0],t.learningRate[0]=s,!et(it,s))return new TypeError(st("0LQ4z","learningRate",it.join('", "'),s));if(e.learningRate.length>1&&("constant"===s||"invscaling"===s)&&(t.learningRate[1]=e.learningRate[1],!W(t.learningRate[1])))return new TypeError(st("invalid option. Second `%s` option must be a positive number. Option: `%s`.","learningRate",t.learningRate[1]));if(e.learningRate.length>2&&"invscaling"===s&&(t.learningRate[2]=e.learningRate[2],!X(t.learningRate[2])))return new TypeError(st("invalid option. Third `%s` option must be a number. Option: `%s`.","learningRate",t.learningRate[2]))}return tt(e,"loss")&&(t.loss=e.loss,!et(rt,t.loss))?new TypeError(st("0LQ3t","loss",rt.join('", "'),t.loss)):null},at=t.isPrimitive,ot=e,dt=s,lt=i,ht=r,pt=J,mt=K,ct=nt;var gt=function(t,e){var s,i,r;if(!at(t))throw new TypeError(ht("0LQ4o",t));if(i={intercept:!0,lambda:1e-4,learningRate:mt.basic.slice(),loss:"log"},arguments.length>1&&(r=ct(i,e)))throw r;return s=new pt(t,i),lt(n,"predict",a),n;function n(t,e){if(0===arguments.length)return s.coefficients;if(!ot(t))throw new TypeError(ht("0LQ4p",t));if(-1!==e&&1!==e)throw new TypeError(ht("0LQ4q",e));if(t.shape[0]!==s.nfeatures)throw new TypeError(ht("0LQ4r",s.nfeatures,t.shape[0]));return s.update(t,e),s.coefficients}function a(e,r){var n,a;if(!dt(e))throw new TypeError(ht("0LQ4s",e));if((n=e.shape)[n.length-1]!==t)throw new TypeError(ht("0LQ4t",t,n[n.length-1]));if(a="label",arguments.length>1){if("probability"===r){if("log"!==i.loss&&"modifiedHuber"!==i.loss)throw new Error(ht("0LQ4u",i.loss))}else if("label"!==r&&"linear"!==r)throw new TypeError(ht('invalid argument. Second argument must be a string value equal to either "label", "probability", or "linear". Value: `%s`.',r));a=r}return s.predict(e,a)}},ft=gt;export{ft as default};
//# sourceMappingURL=index.mjs.map
